/**
 * On regarde les options indiquées
 * On récupère le json fabriqué par la partie serveur du relais (contrôleur) en lui donnant les options indiquées
 * On appelle la vue (script js) en lui donnant le json fabriqué
 */
(function()
{
	console.log('lancement de layout.js');
	//Récupération des valeurs (layout l150 à 209)

		//Source
		if ($('#wordnet').attr('class') == 'activesource') { var source = 'wordnet'; }
		if ($('#dbpedia').attr('class') == 'activesource') { var source = 'dbpedia'; }
		if ($('#debian').attr('class') == 'activesource') { var source = 'debian'; }

		//Vue
		if ($('#radial').attr('class') == 'activevue') { var vue = 'radial'; }
		if ($('#indented').attr('class') == 'activevue') { var vue = 'indented'; }
		if ($('#bubble').attr('class') == 'activevue') { var vue = 'bubble'; }
		if ($('#json').attr('class') == 'activevue') { var vue = 'json'; }

		//Options
		//TODO

		console.log("layout a récupérer les options suivantes : ");
		console.log("source : " + source);
		console.log("vue : " + vue);

	//Utilisation d'ajax pour placer le résultat dans le conteneurD3

		//On alerte le visiteur si il n'a pas rempli correctement tous les champs
		if (!source) { alert('vous devez sélectionner une source de données'); }
		else if (!vue) { alert('vous devez sélectionner une représentation'); }
		//Si il a bien tout rempli on fait le travail
		else 
		{ 
			console.log('layout va récupérer le json pour la source ' + source + 'sur la partie serveur du relais à la route relais_relais_index');
			//On récupère le json (layout l210)
			if (source = 'wordnet') { urlsrc = "{{ path('sources_wordnet_bidon')}}"; } 
			//Astuce pour plus tard : Comment insérer des paramètres à la route ?
			//Réponse : Routing.generate('relais_relais_index', { source: source }), //FOSJsRoutingBundle
			else { alert("Source " + source + " non prise en charge"); }
			$.getJSON(
				urlsrc,
				//Quand on l'a récupéré : (layout l237)
				function(data)
				{
					console.log('layout a récupéré le json suivant :');
					console.log(data);
					//Il faut lancer le script adapté à la vue demandée
					if (vue == 'json') 
					{ 
						console.log('layout appelle maintenant la vue à la route vues_representations_json en lui donnant le json');
						$.getScript(Routing.generate('vues_representations_json',{ data: JSON.stringify(data) })); 
					}
					else { alert('vue ' + vue + ' non prise en charge'); }
				}
			); 
		}
})();

